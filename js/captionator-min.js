/* 
	Captionator 0.5a [CaptionCrunch]
	Christopher Giffard, 2011
	Share and enjoy

	https://github.com/cgiffard/Captionator
*/

(function(){var z=[0,0,0,0.5],e={createDOMException:function(a,c,b){try{document.querySelectorAll("div/[]")}catch(e){var d=function(a,b,c){this.code=a;this.message=b;this.name=c};d.prototype=e;return new d(a,c,b)}},compareArray:function(a,c){if(!(a instanceof Array)||!(c instanceof Array))return!1;if(a.length!==c.length)return!1;for(var b in a)if(a.hasOwnProperty(b)&&a[b]!==c[b])return!1;return!0},generateID:function(a){for(var c="",a=a?a:10;c.length<a;)c+=String.fromCharCode(65+Math.floor(Math.random()*
26));return"captionator"+c},captionify:function(a,c,b){var g=[],d=0,b=b instanceof Object?b:{};if(HTMLVideoElement){if(typeof document.createElement("video").addTrack==="function")return!1}else return!1;e.TextTrack=function(a,b,c,g,d,m){this.onload=function(){};this.onerror=function(){};this.oncuechange=function(){};this.id=a||"";this.internalMode=e.TextTrack.OFF;this.cues=new e.TextTrackCueList(this);this.activeCues=new e.ActiveTextTrackCueList(this.cues,this);this.kind=b||"subtitles";this.label=
c||"";this.language=g||"";this.src=d||"";this.readyState=e.TextTrack.NONE;this.internalDefault=m||!1;this.getMode=function(){return this.internalMode};this.setMode=function(a){if([e.TextTrack.OFF,e.TextTrack.HIDDEN,e.TextTrack.SHOWING].indexOf(a)!==-1){if(a!==this.internalMode){this.internalMode=a;this.readyState===e.TextTrack.NONE&&this.src.length>0&&a>e.TextTrack.OFF&&this.loadTrack(this.src,null);this.readyState===e.TextTrack.LOADED&&e.rebuildCaptions(this.videoNode);if((a===e.TextTrack.OFF||a===
e.TextTrack.HIDDEN)&&this.videoNode.containerObject)try{this.videoNode.containerObject.parentNode.removeChild(this.videoNode.containerObject)}catch(b){}if(a===e.TextTrack.OFF)this.cues.length=0,this.readyState=e.TextTrack.NONE}}else throw Error("Illegal mode value for track: "+a);};this.getDefault=function(){return this.internalDefault};Object.prototype.__defineGetter__?(this.__defineGetter__("mode",this.getMode),this.__defineSetter__("mode",this.setMode),this.__defineGetter__("default",this.getDefault)):
Object.defineProperty&&(Object.defineProperty(this,"mode",{get:this.getMode,set:this.setMode}),Object.defineProperty(this,"default",{get:this.getDefault}));this.loadTrack=function(a,b){var c,f=new XMLHttpRequest;if(this.readyState===e.TextTrack.LOADED)b instanceof Function&&b(c);else{this.src=a;this.readyState=e.TextTrack.LOADING;var h=this;f.open("GET",a,!0);f.onreadystatechange=function(){if(f.readyState===4)if(f.status===200){var a=h.videoNode._captionatorOptions||{};if(h.kind==="metadata")a.processCueHTML=
!1,a.sanitiseCueHTML=!1;c=e.parseCaptions(f.responseText,a);h.readyState=e.TextTrack.LOADED;e.rebuildCaptions(h.videoNode);h.cues.loadCues(c);h.onload();b instanceof Function&&b.call(h,c)}else h.readyState=e.TextTrack.ERROR,h.onerror()};try{f.send(null)}catch(l){h.readyState=e.TextTrack.ERROR,h.onerror(l)}}};this.addCue=function(){};this.removeCue=function(){}};e.TextTrack.NONE=0;e.TextTrack.LOADING=1;e.TextTrack.LOADED=2;e.TextTrack.ERROR=3;e.TextTrack.OFF=0;e.TextTrack.HIDDEN=1;e.TextTrack.SHOWING=
2;e.TextTrackCueList=function(a){this.track=a instanceof e.TextTrack?a:null;this.getCueById=function(a){return this.filter(function(b){return b.id===a})[0]};this.loadCues=function(a){for(var b=0;b<a.length;b++)a[b].track=this.track,Array.prototype.push.call(this,a[b])};this.toString=function(){return"[TextTrackCueList]"}};e.TextTrackCueList.prototype=[];e.ActiveTextTrackCueList=function(a,b){this.refreshCues=function(){if(a.length){var c=this,e=!1,g=[].slice.call(this,0);this.length=0;a.forEach(function(a){a.active&&
(c.push(a),c[c.length-1]!==g[c.length-1]&&(e=!0))});if(e)try{b.oncuechange()}catch(d){}}};this.toString=function(){return"[ActiveTextTrackCueList]"};this.refreshCues()};e.ActiveTextTrackCueList.prototype=new e.TextTrackCueList(null);e.TextTrackCue=function(a,b,c,g,d,m,k){this.id=a;this.track=k instanceof e.TextTrack?k:null;this.startTime=parseFloat(b);this.endTime=parseFloat(c);this.text=typeof g==="string"||g instanceof e.CaptionatorCueStructure?g:"";this.settings=typeof d==="string"?d:"";this.intSettings=
{};this.pauseOnExit=!!m;this.wasActive=!1;this.direction="horizontal";this.snapToLines=!0;this.linePosition="auto";this.textPosition=50;this.size=100;this.alignment="middle";if(this.settings.length){var o=this.intSettings,p=this,d=d.split(/\s+/).filter(function(a){return a.length>0});d instanceof Array&&d.forEach(function(a){var b={D:"direction",L:"linePosition",T:"textPosition",A:"alignment",S:"size"},a=a.split(":");b[a[0]]&&(o[b[a[0]]]=a[1]);b[a[0]]in p&&(p[b[a[0]]]=a[1])})}if(this.linePosition.match(/\%/))this.snapToLines=
!1;this.getCueAsSource=function(){return String(this.text)};this.getCueAsHTML=function(){var a=document.createDocumentFragment(),b=document.createElement("div");b.innerHTML=String(this.text);Array.prototype.forEach.call(b.childNodes,function(b){a.appendChild(b.cloneNode(!0))});return a};this.isActive=function(){var a=0;if(this.track instanceof e.TextTrack&&this.track.mode===e.TextTrack.SHOWING&&this.track.readyState===e.TextTrack.LOADED)try{if(a=this.track.videoNode.currentTime,this.startTime<=a&&
this.endTime>=a){if(!this.wasActive)this.wasActive=!0,this.onenter();return!0}}catch(b){return!1}if(this.wasActive)this.wasActive=!1,this.onexit();return!1};Object.prototype.__defineGetter__?this.__defineGetter__("active",this.isActive):Object.defineProperty&&Object.defineProperty(this,"active",{get:this.isActive});this.toString=function(){return"TextTrackCue:"+this.id+"\n"+String(this.text)};this.onenter=function(){};this.onexit=function(){}};e.MediaTrack=function(){this.mediaElement=null};e.CaptionatorCueStructure=
function(a,b){var c=this;this.isTimeDependent=!1;this.cueSource=a;this.options=b;this.processedCue=null;this.toString=function(e){if(b.processCueHTML!==!1){var g=function(a){if(c.processedCue===null){var b="",f,d;for(f in a)if(f.match(/^\d+$/)&&a.hasOwnProperty(f))if(d=a[f],d instanceof Object&&d.children&&d.children.length)if(d.token==="v")b+='<q data-voice="'+d.voice.replace(/[\"]/g,"")+"\" class='voice speaker-"+d.voice.replace(/[^a-z0-9]+/ig,"-").toLowerCase()+"' title=\""+d.voice.replace(/[\"]/g,
"")+'">'+g(d.children)+"</q>";else if(d.token==="c")b+="<span class='webvtt-class-span "+d.classes.join(" ")+"'>"+g(d.children)+"</span>";else if(d.timeIn>0){if(e===null||e===void 0||e>0&&e>=d.timeIn)b+="<span class='webvtt-timestamp-span' data-timestamp='"+d.token+"' data-timestamp-seconds='"+d.timeIn+"'>"+g(d.children)+"</span>"}else b+=d.rawToken+g(d.children)+"</"+d.token+">";else if(d instanceof String||typeof d==="string"||typeof d==="number")b+=d;if(!c.isTimeDependent)c.processedCue=b;return b}else return c.processedCue};
return g(this)}else return a}};e.CaptionatorCueStructure.prototype=[];if(b.exportObjects)window.TextTrack=e.TextTrack,window.TextTrackCueList=e.TextTrackCueList,window.ActiveTextTrackCueList=e.ActiveTextTrackCueList,window.TextTrackCue=e.TextTrackCue,window.MediaTrack=e.MediaTrack;[].slice.call(document.getElementsByTagName("video"),0).forEach(function(a){a.addTrack=function(b,c,d,g,m,k,o){var p=["subtitles","captions","descriptions","captions","metadata","karaoke","lyrics","tickertext","audiodescription",
"commentary","alternate","signlanguage"],n=p.slice(0,7),b=typeof b==="string"?b:"",d=typeof d==="string"?d:"",g=typeof g==="string"?g:"",o=typeof o==="boolean"?o:!1;if(!p.filter(function(a){return c===a?!0:!1}).length)throw e.createDOMException(12,"DOMException 12: SYNTAX_ERR: You must use a valid kind when creating a TimedTextTrack.","SYNTAX_ERR");if(n.filter(function(a){return c===a?!0:!1}).length)if(b=new e.TextTrack(b,c,d,g,m,null)){if(!(a.tracks instanceof Array))a.tracks=[];a.tracks.push(b);
return b}else return!1;else if(b=new e.MediaTrack(b,c,d,g,m,k,o)){if(!(a.mediaTracks instanceof Array))a.mediaTracks=[];a.mediaTracks.push(b);return b}else return!1}});if(!a||a===!1||a===void 0||a===null)g=[].slice.call(document.getElementsByTagName("video"),0);else if(a instanceof Array)for(d=0;d<a.length;d++)typeof a[d]==="string"?g=g.concat([].slice.call(document.querySelectorAll(a[d]),0)):a[d].constructor===HTMLVideoElement&&g.push(a[d]);else typeof a==="string"?g=[].slice.call(document.querySelectorAll(a),
0):a.constructor===HTMLVideoElement&&g.push(a);if(g.length){for(d=0;d<g.length;d++)e.processVideoElement(g[d],c,b);return!0}else return!1},processVideoElement:function(a,c,b){var g=[],d=navigator.language||navigator.userLanguage;c||d.split("-");b=b instanceof Object?b:{};if(!a.captioned){a._captionatorOptions=b;a.className+=(a.className.length?" ":"")+"captioned";a.captioned=!0;if(a.id.length===0)a.id=e.generateID();[].slice.call(a.querySelectorAll("track"),0).forEach(function(d){var f=null,f=d.querySelectorAll("source").length>
0?d.querySelectorAll("source"):d.getAttribute("src"),f=a.addTrack(d.getAttribute("id")||e.generateID(),d.getAttribute("kind"),d.getAttribute("label"),d.getAttribute("srclang").split("-")[0],f,d.getAttribute("type"),d.hasAttribute("default"));d.track=f;f.trackNode=d;f.videoNode=a;g.push(f);var h=!1;if((f.kind==="subtitles"||f.kind==="captions")&&c===f.language&&b.enableCaptionsByDefault)g.filter(function(a){return(a.kind==="captions"||a.kind==="subtitles")&&c===a.language&&a.mode===e.TextTrack.SHOWING?
!0:!1}).length||(h=!0);f.kind==="chapters"&&c===f.language&&(g.filter(function(a){return a.kind==="chapters"&&a.mode===e.TextTrack.SHOWING?!0:!1}).length||(h=!0));f.kind==="descriptions"&&b.enableDescriptionsByDefault===!0&&c===f.language&&(g.filter(function(a){return a.kind==="descriptions"&&a.mode===e.TextTrack.SHOWING?!0:!1}).length||(h=!0));h===!0&&g.forEach(function(a){if(a.trackNode.hasAttribute("default")&&a.mode===e.TextTrack.SHOWING)a.mode=e.TextTrack.HIDDEN});if(d.hasAttribute("default")&&
!g.filter(function(a){return a.trackNode.hasAttribute("default")&&a.trackNode!==d?!0:!1}).length)h=!0,f.internalDefault=!0;if(h===!0)f.mode=e.TextTrack.SHOWING});a.addEventListener("timeupdate",function(a){a=a.target;try{a.tracks.forEach(function(a){a.activeCues.refreshCues.apply(a.activeCues)})}catch(c){}b.renderer instanceof Function?b.renderer.call(e,a):e.rebuildCaptions(a);e.synchroniseMediaElements(a)},!1);a.addEventListener("play",function(){e.synchroniseMediaElements(a)},!1);a.addEventListener("pause",
function(){e.synchroniseMediaElements(a)},!1)}return a},rebuildCaptions:function(a){var c=a.currentTime,b=[],g=!1,d=[],l=[];(a.tracks||[]).forEach(function(a){a.mode===e.TextTrack.SHOWING&&a.readyState===e.TextTrack.LOADED&&(l=[].slice.call(a.activeCues,0),l=l.sort(function(a,b){return a.startTime>b.startTime?-1:1}),b=b.concat(l))});d=b.map(function(a){return a.track.id+"."+a.id+":"+a.text.toString(c).length});if(g=!e.compareArray(d,a._captionator_previousActiveCues))a._captionator_availableCueArea=
null,a._captionator_previousActiveCues=d,e.styleCueCanvas(a),a._containerObject.innerHTML="",b.forEach(function(b){var d=document.createElement("div");d.id=String(b.id).length?b.id:e.generateID();d.className="captionator-cue";d.innerHTML=b.text.toString(c);a._containerObject.appendChild(d);e.styleCue(d,b,a)})},synchroniseMediaElements:function(a){var c=function(a,c){try{c.seeking&&a.pause();if(a.currentTime<c.currentTime-0.5||a.currentTime>c.currentTime+0.5)a.currentTime=c.currentTime;a.paused&&!c.paused?
a.play():!a.paused&&c.paused&&a.pause()}catch(d){}};(a.mediaTracks||[]).forEach(function(b){b.mode===e.TextTrack.SHOWING&&b.readyState>=e.TextTrack.LOADING&&c(b.mediaElement,a)});a.id&&[].slice.call(document.body.querySelectorAll("*[syncMaster="+a.id+"]"),0).forEach(function(b){(b.tagName.toLowerCase()==="video"||b.tagName.toLowerCase()==="audio")&&c(b,a)})},getNodeMetrics:function(a){for(var c=window.getComputedStyle(a,null),b=a,e=a.offsetTop,d=a.offsetLeft,l=a,f=0,h=0,l=parseInt(c.getPropertyValue("width"),
10),f=parseInt(c.getPropertyValue("height"),10);b=b.offsetParent;)e+=b.offsetTop,d+=b.offsetLeft;a.hasAttribute("controls")&&(a=navigator.userAgent.toLowerCase(),a.indexOf("chrome")!==-1?h=32:a.indexOf("opera")!==-1?h=25:a.indexOf("firefox")!==-1?h=28:a.indexOf("ie 9")!==-1||a.indexOf("ipad")!==-1?h=44:a.indexOf("safari")!==-1&&(h=25));return{left:d,top:e,width:l,height:f,controlHeight:h}},applyStyles:function(a,c){for(var b in c)({}).hasOwnProperty.call(c,b)&&(a.style[b]=c[b])},checkDirection:function(a){var c=
RegExp("^[^\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]*[A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]");return RegExp("^[^A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]*[\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]").test(a)?"rtl":c.test(a)?"ltr":""},styleCue:function(a,c,b){var g=0,d=0,l=0,f=0,h,r,v=0,m=0,k,o,p,n,s=0,j=h=d=0,i=0,u=0,q=0,x,w,t=0,y=function(a){var b=function(a){return!!a.length},
c,d,g,f,k=0,i=function(a){k++;e.applyStyles(a,{display:"block",lineHeight:"auto",height:o+"px",width:n+"px",textAlign:"center"})};for(c in a.childNodes)if(a.childNodes.hasOwnProperty(c))d=a.childNodes[c],d.nodeType===3?(f=document.createDocumentFragment(),g=d.nodeValue,f.appendChild(document.createElement("span")),f.childNodes[0].innerHTML="<span class='captionator-cue-character'>"+g.split(/(.)/).filter(b).join("</span><span class='captionator-cue-character'>")+"</span>",[].slice.call(f.querySelectorAll("span.captionator-cue-character"),
0).forEach(i),d.parentNode.replaceChild(f,d)):a.childNodes[c].nodeType===1&&(k+=y(a.childNodes[c]));return k},i=e.getNodeMetrics(b);if(!b._captionator_availableCueArea)b._captionator_availableCueArea={bottom:i.height-i.controlHeight,right:i.width,top:0,left:0,height:i.height-i.controlHeight,width:i.width};k=i.height*0.045/96*72;k=k>=10?k:10;o=Math.floor(k/72*96);p=Math.floor(k*1.5);p=p>16?p:16;n=k=Math.ceil(p/72*96);k*Math.floor(i.height/k)<i.height&&(k=Math.floor(i.height/Math.floor(i.height/k)),
p=Math.ceil(k/96*72));k*Math.floor(i.width/k)<i.width&&(n=Math.ceil(i.width/Math.floor(i.width/k)));d=Math.floor(b._captionator_availableCueArea.height/k);g=Math.floor(b._captionator_availableCueArea.width/n);h=parseFloat(String(c.size).replace(/[^\d\.]/ig,""));h=h<=100?h:100;v=c.direction==="horizontal"?Math.floor(i.width*0.01):0;m=c.direction==="horizontal"?0:Math.floor(i.height*0.01);if(c.linePosition==="auto")c.linePosition=c.direction==="horizontal"?d:g;else if(String(c.linePosition).match(/\%/))c.snapToLines=
!1,c.linePosition=parseFloat(String(c.linePosition).replace(/\%/ig,""));c.direction==="horizontal"?(f=k,l=c.snapToLines===!0?b._captionator_availableCueArea.width*(h/100):i.width*(h/100),c.textPosition==="auto"?g=(b._captionator_availableCueArea.right-l)/2+b._captionator_availableCueArea.left:(c.textPosition=parseFloat(String(c.textPosition).replace(/[^\d\.]/ig,"")),g=(i.right-l)*(c.textPosition/100)+i.left),d=c.snapToLines===!0?(d-1)*k+b._captionator_availableCueArea.top:(i.height-(i.controlHeight+
k+m*2))*(c.linePosition/100)):(d=b._captionator_availableCueArea.top,g=b._captionator_availableCueArea.right-n,l=n,f=b._captionator_availableCueArea.height*(h/100),d=y(a),h=[].slice.call(a.querySelectorAll("span.captionator-cue-character"),0),s=Math.floor((f-m*2)/o),l=Math.ceil(d/s)*n,j=Math.ceil(d/s),u=(d-s*(j-1))*o,c.snapToLines===!0?g=c.direction==="vertical-lr"?b._captionator_availableCueArea.left:b._captionator_availableCueArea.right-l:(d=l+v*2,g=c.direction==="vertical-lr"?(i.width-d)*(c.linePosition/
100):i.width-d-(i.width-d)*(c.linePosition/100)),c.textPosition==="auto"?d=(b._captionator_availableCueArea.bottom-f)/2+b._captionator_availableCueArea.top:(c.textPosition=parseFloat(String(c.textPosition).replace(/[^\d\.]/ig,"")),d=(b._captionator_availableCueArea.bottom-f)*(c.textPosition/100)+b._captionator_availableCueArea.top),w=x=t=q=0,h.forEach(function(a){x=c.direction==="vertical-lr"?n*q:l-n*(q+1);c.alignment==="start"||c.alignment!=="start"&&q<j-1?w=t*o+m:c.alignment==="end"?w=t*o-o+(f+
m*2-u):c.alignment==="middle"&&(w=(f-m*2-u)/2+t*o);e.applyStyles(a,{position:"absolute",top:w+"px",left:x+"px"});t>=s-1?(t=0,q++):t++}));c.direction==="horizontal"&&(r=e.checkDirection(String(c.text))==="rtl"?{start:"right",middle:"center",end:"left"}[c.alignment]:{start:"left",middle:"center",end:"right"}[c.alignment]);e.applyStyles(a,{position:"absolute",overflow:"hidden",width:l+"px",height:f+"px",top:d+"px",left:g+"px",padding:m+"px "+v+"px",textAlign:r,backgroundColor:"rgba("+z.join(",")+")",
direction:e.checkDirection(String(c.text)),lineHeight:p+"pt",boxSizing:"border-box"});if(c.direction==="vertical"||c.direction==="vertical-lr")g-b._captionator_availableCueArea.left-b._captionator_availableCueArea.left>=b._captionator_availableCueArea.right-(g+l)?b._captionator_availableCueArea.right=g:b._captionator_availableCueArea.left=g+l,b._captionator_availableCueArea.width=b._captionator_availableCueArea.right-b._captionator_availableCueArea.left;else{if(a.scrollHeight>a.offsetHeight*1.2){if(c.snapToLines){for(r=
0;a.scrollHeight>a.offsetHeight*1.2;)f+=k,a.style.height=f+"px",r++;d-=r*k}else r=a.scrollHeight-f,f=a.scrollHeight+i.height*0.01,d-=r,a.style.height=f+"px";a.style.top=d+"px"}d-b._captionator_availableCueArea.top-b._captionator_availableCueArea.top>=b._captionator_availableCueArea.bottom-(d+f)?b._captionator_availableCueArea.bottom=d:b._captionator_availableCueArea.top=d+f;b._captionator_availableCueArea.height=b._captionator_availableCueArea.bottom-b._captionator_availableCueArea.top}},styleCueCanvas:function(a){var c,
b;if(!(a instanceof HTMLVideoElement))throw Error("Cannot style a cue canvas for a non-video node!");if(a._containerObject)b=a._containerObject,c=b.id;b?b.parentNode||document.body.appendChild(b):(b=document.createElement("div"),b.className="captionator-cue-canvas",c=e.generateID(),b.id=c,document.body.appendChild(b),a._containerObject=b,b.setAttribute("aria-live","polite"),b.setAttribute("aria-atomic","true"));if(String(a.getAttribute("aria-describedby")).indexOf(c)===-1){var g=a.hasAttribute("aria-describedby")?
a.getAttribute("aria-describedby")+" ":"";a.setAttribute("aria-describedby",g+c)}g=e.getNodeMetrics(a);a=g.height*0.045/96*72;a=a>=10?a:10;c=Math.floor(a*1.5);e.applyStyles(b,{position:"absolute",overflow:"hidden",zIndex:100,height:g.height-g.controlHeight+"px",width:g.width+"px",top:g.top+"px",left:g.left+"px",color:"white",fontFamily:"Verdana, Helvetica, Arial, sans-serif",fontSize:a+"pt",lineHeight:(c>16?c:16)+"pt",boxSizing:"border-box"});if(window.navigator.userAgent.toLowerCase().indexOf("chrome/10")>
-1)b.style.backgroundColor="rgba(0,0,0,0.01"+Math.random().toString().replace(".","")+")"},parseCaptions:function(a,c){var c=c instanceof Object?c:{},b="",g=[],d=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\,(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,l=/^(\d+)?:?(\d{2}):(\d{2})\.(\d+)\,(\d+)?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,f=/^(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s*(.*)/,h=/(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)/,r=/^([\d\.]+)\s+\+([\d\.]+)\s*(.*)/,v=/^\[(\d{2})?:?(\d{2})\:(\d{2})\.(\d{2})\]\s*(.*?)$/i;
if(a){var m=function(a){var b=new e.CaptionatorCueStructure(a,c),d=[],g,f,j,i=[];j=0;var l=function(a){return!!a.replace(/[^a-z0-9]+/ig,"").length},d=a.split(/(<\/?[^>]+>)/ig).filter(function(a){return!!a.replace(/\s*/ig,"")});j=b;for(g in d)if(d.hasOwnProperty(g))if(f=d[g],f.substr(0,1)==="<")if(f.substr(1,1)==="/"){if(a=f.substr(2).split(/[\s>]+/g)[0],i.length>0){f=0;for(j=i.length-1;j>=0;j--){var m=i[j][i[j].length-1];f=j;if(m.token===a)break}j=i[f];i=i.slice(0,f)}}else{if(f.substr(1).match(h)||
f.match(/^<v\s+[^>]+>/i)||f.match(/^<c[a-z0-9\-\_\.]+>/)||f.match(/^<(b|i|u|ruby|rt)>/)||c.sanitiseCueHTML!==!1){a={token:f.replace(/[<\/>]+/ig,"").split(/[\s\.]+/)[0],rawToken:f,children:[]};if(a.token==="v")a.voice=f.match(/^<v\s*([^>]+)>/i)[1];else if(a.token==="c")a.classes=f.replace(/[<\/>\s]+/ig,"").split(/[\.]+/ig).slice(1).filter(l);else if(f=a.rawToken.match(h))b.isTimeDependent=!0,f=f.slice(1),a.timeIn=parseInt((f[0]||0)*3600,10)+parseInt((f[1]||0)*60,10)+parseInt(f[2]||0,10)+parseFloat("0."+
(f[3]||0));j.push(a);i.push(j);j=a.children}}else c.sanitiseCueHTML!==!1&&(f=f.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\&/g,"&amp;")),j.push(f);return b},g=a.replace(/\r\n/g,"\n").replace(/\r/g,"\n");v.exec(a)?(g=g.split(/\n+/g),b="LRC"):g=g.split(/\n\n+/g);return g=g.filter(function(a){if(a.match(/^WEBVTT(\s*FILE)?/ig))b="WebVTT";else if(a.replace(/\s*/ig,"").length)return!0;return!1}).map(function(a,g){var h,n,s,j,i,u;for(h=b==="LRC"?[a.substr(0,a.indexOf("]")),a.substr(a.indexOf("]")+
1)]:a.split(/\n/g);!h[0].replace(/\s+/ig,"").length&&h.length>0;)h.shift();for(u=h[0].match(/^\s*\d+\s*$/ig)?String(h.shift().replace(/\s*/ig,"")):g;0<h.length;){var q=h[0];if((j=f.exec(q))||(j=d.exec(q))||(j=l.exec(q)))j=j.slice(1),n=parseInt((j[0]||0)*3600,10)+parseInt((j[1]||0)*60,10)+parseInt(j[2]||0,10)+parseFloat("0."+(j[3]||0)),s=parseInt((j[4]||0)*3600,10)+parseInt((j[5]||0)*60,10)+parseInt(j[6]||0,10)+parseFloat("0."+(j[7]||0)),j[8]&&(i=j[8]);else if(j=r.exec(q))j=j.slice(1),n=parseFloat(j[0]),
s=n+parseFloat(j[1]),j[2]&&(i=j[2]);h=h.slice(0,0).concat(h.slice(1));break}h=c.processCueHTML===!1?h.join("\n"):m(h.join("\n"));return new e.TextTrackCue(u,n,s,h,i,!1,null)})}else throw Error("Required parameter captionData not supplied.");}};window.captionator=e})();