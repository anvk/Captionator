/* 
	Captionator 0.5a [CaptionCrunch]
	Christopher Giffard, 2011
	Share and enjoy

	https://github.com/cgiffard/Captionator
*/

(function(){var F=[0,0,0,0.5],c={createDOMException:function(b,c,a){try{document.querySelectorAll("div/[]")}catch(d){var f=function(a,b,c){this.code=a;this.message=b;this.name=c};f.prototype=d;return new f(b,c,a)}},generateID:function(c){for(var e="",c=c?c:10;e.length<c;)e+=String.fromCharCode(65+Math.floor(Math.random()*26));return"captionator"+e},captionify:function(b,e,a){var d=[],f=0,a=a instanceof Object?a:{};if(HTMLVideoElement){if(typeof document.createElement("video").addTrack==="function")return!1}else return!1;
c.TextTrack=function(a,b,e,d,f,n){this.onload=function(){};this.onerror=function(){};this.oncuechange=function(){};this.id=a||"";this.internalMode=c.TextTrack.OFF;this.cues=new c.TextTrackCueList(this);this.activeCues=new c.ActiveTextTrackCueList(this.cues);this.kind=b||"subtitles";this.label=e||"";this.language=d||"";this.src=f||"";this.readyState=c.TextTrack.NONE;this.internalDefault=n||!1;this.getMode=function(){return this.internalMode};this.setMode=function(a){if([c.TextTrack.OFF,c.TextTrack.HIDDEN,
c.TextTrack.SHOWING].indexOf(a)!==-1){if(a!==this.internalMode){this.internalMode=a;this.readyState===c.TextTrack.NONE&&this.src.length>0&&a>c.TextTrack.OFF&&this.loadTrack(this.src,null);this.readyState===c.TextTrack.LOADED&&c.rebuildCaptions(this.videoNode);if((a===c.TextTrack.OFF||a===c.TextTrack.HIDDEN)&&this.videoNode.containerObject)try{this.videoNode.containerObject.parentNode.removeChild(this.videoNode.containerObject)}catch(b){}if(a===c.TextTrack.OFF)this.cues.length=0,this.readyState=c.TextTrack.NONE}}else throw Error("Illegal mode value for track: "+
a);};this.getDefault=function(){return this.internalDefault};Object.prototype.__defineGetter__?(this.__defineGetter__("mode",this.getMode),this.__defineSetter__("mode",this.setMode),this.__defineGetter__("default",this.getDefault)):Object.defineProperty&&(Object.defineProperty(this,"mode",{get:this.getMode,set:this.setMode}),Object.defineProperty(this,"default",{get:this.getDefault}));this.loadTrack=function(a,b){var e,g=new XMLHttpRequest;if(this.readyState===c.TextTrack.LOADED)b instanceof Function&&
b(e);else{this.src=a;this.readyState=c.TextTrack.LOADING;var h=this;g.open("GET",a,!0);g.onreadystatechange=function(){if(g.readyState===4)if(g.status===200){var a=h.videoNode._captionatorOptions||{};if(h.kind==="metadata")a.processCueHTML=!1,a.sanitiseCueHTML=!1;e=c.parseCaptions(g.responseText,a);h.readyState=c.TextTrack.LOADED;c.rebuildCaptions(h.videoNode);h.cues.loadCues(e);h.onload();b instanceof Function&&b.call(h,e)}else h.readyState=c.TextTrack.ERROR,h.onerror()};try{g.send(null)}catch(i){h.readyState=
c.TextTrack.ERROR,h.onerror(i)}}};this.addCue=function(){};this.removeCue=function(){}};c.TextTrack.NONE=0;c.TextTrack.LOADING=1;c.TextTrack.LOADED=2;c.TextTrack.ERROR=3;c.TextTrack.OFF=0;c.TextTrack.HIDDEN=1;c.TextTrack.SHOWING=2;c.TextTrackCueList=function(a){this.track=a instanceof c.TextTrack?a:null;this.getCueById=function(a){return this.filter(function(c){return c.id===a})[0]};this.loadCues=function(a){for(var c=0;c<a.length;c++)a[c].track=this.track,Array.prototype.push.call(this,a[c])};this.toString=
function(){return"[TextTrackCueList]"}};c.TextTrackCueList.prototype=[];c.ActiveTextTrackCueList=function(a){this.refreshCues=function(){var c=this;this.length=0;a.forEach(function(a){a.active&&c.push(a)})};this.toString=function(){return"[ActiveTextTrackCueList]"};this.refreshCues()};c.ActiveTextTrackCueList.prototype=new c.TextTrackCueList(null);c.TextTrackCue=function(a,b,e,d,f,n,o){this.id=a;this.track=o instanceof c.TextTrack?o:null;this.startTime=parseFloat(b);this.endTime=parseFloat(e);this.text=
typeof d==="string"||d instanceof c.CaptionatorCueStructure?d:"";this.settings=typeof f==="string"?f:"";this.intSettings={};this.pauseOnExit=!!n;this.direction="horizontal";this.snapToLines=!0;this.linePosition="auto";this.textPosition=50;this.size=100;this.alignment="middle";if(this.settings.length){var p=this.intSettings,s=this,f=f.split(/\s+/).filter(function(a){return a.length>0});f instanceof Array&&f.forEach(function(a){var c={D:"direction",L:"linePosition",T:"textPosition",A:"alignment",S:"size"},
a=a.split(":");c[a[0]]&&(p[c[a[0]]]=a[1]);c[a[0]]in s&&(s[c[a[0]]]=a[1])})}if(this.linePosition.match(/\%/))this.snapToLines=!1;this.getCueAsSource=function(){return String(this.text)};this.getCueAsHTML=function(){var a=document.createDocumentFragment(),c=document.createElement("div");c.innerHTML=String(this.text);Array.prototype.forEach.call(c.childNodes,function(c){a.appendChild(c.cloneNode(!0))});return a};this.isActive=function(){var a=0;if(this.track instanceof c.TextTrack&&this.track.mode===
c.TextTrack.SHOWING&&this.track.readyState===c.TextTrack.LOADED)try{if(a=this.track.videoNode.currentTime,this.startTime<=a&&this.endTime>=a)return!0}catch(b){}return!1};Object.prototype.__defineGetter__?this.__defineGetter__("active",this.isActive):Object.defineProperty&&Object.defineProperty(this,"active",{get:this.isActive});this.onenter=function(){};this.onexit=function(){}};c.MediaTrack=function(a,b,e,d,f,n){var o=function(a){return a.filter(function(a){try{var c=document.createElement(a.getAttribute("type").split("/").shift());
return!(!c.canPlayType||!c.canPlayType(a.getAttribute("type")).replace(/no/,""))}catch(b){return!1}}).shift().getAttribute("src")};this.onload=function(){};this.onerror=function(){};this.id=a||"";this.internalMode=this.internalMode=c.TextTrack.OFF;this.mediaElement=null;this.kind=b||"audiodescription";this.label=e||"";this.language=d||"";this.readyState=c.TextTrack.NONE;this.type=n||"x/unknown";this.mediaType=null;this.src="";if(typeof f==="string")this.src=f;else if(f instanceof NodeList)this.src=
o(f);if(this.type.match(/^video\//))this.mediaType="video";else if(this.type.match(/^audio\//))this.mediaType="audio";this.getMode=function(){return this.internalMode};this.setMode=function(a){if([c.TextTrack.OFF,c.TextTrack.HIDDEN,c.TextTrack.SHOWING].indexOf(a)!==-1){if(a!==this.internalMode)this.internalMode=a,a===c.TextTrack.HIDDEN&&!this.mediaElement&&this.buildMediaElement(),a===c.TextTrack.SHOWING&&this.showMediaElement(),(a===c.TextTrack.OFF||a===c.TextTrack.HIDDEN)&&this.hideMediaElement()}else throw Error("Illegal mode value for track.");
};Object.prototype.__defineGetter__?(this.__defineGetter__("mode",this.getMode),this.__defineSetter__("mode",this.setMode)):Object.defineProperty&&Object.defineProperty(this,"mode",{get:this.getMode,set:this.setMode});this.hideMediaElement=function(){if(this.mediaElement&&(this.mediaElement.paused||this.mediaElement.pause(),this.mediaElement instanceof HTMLVideoElement))this.mediaElement.style.display="none"};this.showMediaElement=function(){if(this.mediaElement){if(this.mediaElement.parentNode||
document.body.appendChild(this.mediaElement),this.mediaElement instanceof HTMLVideoElement)this.mediaElement.style.display="block"}else this.buildMediaElement(),document.body.appendChild(this.mediaElement)};this.buildMediaElement=function(){try{if(this.type.match(/^video\//))this.mediaElement=document.createElement("video"),this.mediaElement.className="captionator-mediaElement-"+this.kind,c.styleNode(this.mediaElement,this.kind,this.videoNode);else if(this.type.match(/^audio\//))this.mediaElement=
new Audio;this.mediaElement.type=this.type;this.mediaElement.src=this.src;this.mediaElement.load();this.mediaElement.trackObject=this;this.readyState=c.TextTrack.LOADING;var a=this.mediaElement;this.mediaElement.addEventListener("progress",function(){a.trackObject.readyState=c.TextTrack.LOADING},!1);this.mediaElement.addEventListener("canplaythrough",function(){a.trackObject.readyState=c.TextTrack.LOADED;a.trackObject.onload.call(a.trackObject)},!1);this.mediaElement.addEventListener("error",function(b){a.trackObject.readyState=
c.TextTrack.ERROR;a.trackObject.mode=c.TextTrack.OFF;a.trackObject.mediaElement=null;a.trackObject.onerror.call(a.trackObject,b)},!1)}catch(b){this.readyState=c.TextTrack.ERROR,this.mode=c.TextTrack.OFF,this.mediaElement=null,this.onerror.call(this,b)}}};c.CaptionatorCueStructure=function(a,c){var b=this;this.isTimeDependent=!1;this.cueSource=a;this.options=c;this.processedCue=null;this.toString=function(e){if(c.processCueHTML!==!1){var f=function(a){if(b.processedCue===null){var c="",g,d;for(g in a)if(g.match(/^\d+$/)&&
a.hasOwnProperty(g))if(d=a[g],d instanceof Object&&d.children&&d.children.length)if(d.token==="v")c+='<q data-voice="'+d.voice.replace(/[\"]/g,"")+"\" class='voice speaker-"+d.voice.replace(/[^a-z0-9]+/ig,"-").toLowerCase()+"' title=\""+d.voice.replace(/[\"]/g,"")+'">'+f(d.children)+"</q>";else if(d.token==="c")c+="<span class='webvtt-class-span "+d.classes.join(" ")+"'>"+f(d.children)+"</span>";else if(d.timeIn>0){if(e===null||e===void 0||e>0&&e>=d.timeIn)c+="<span class='webvtt-timestamp-span' data-timestamp='"+
d.token+"' data-timestamp-seconds='"+d.timeIn+"'>"+f(d.children)+"</span>"}else c+=d.rawToken+f(d.children)+"</"+d.token+">";else if(d instanceof String||typeof d==="string"||typeof d==="number")c+=d;if(!b.isTimeDependent)b.processedCue=c;return c}else return b.processedCue};return f(this)}else return a}};c.CaptionatorCueStructure.prototype=[];if(a.exportObjects)window.TextTrack=c.TextTrack,window.TextTrackCueList=c.TextTrackCueList,window.ActiveTextTrackCueList=c.ActiveTextTrackCueList,window.TextTrackCue=
c.TextTrackCue,window.MediaTrack=c.MediaTrack;[].slice.call(document.getElementsByTagName("video"),0).forEach(function(a){a.addTrack=function(b,e,d,f,n,o,p){var s=["subtitles","captions","descriptions","captions","metadata","karaoke","lyrics","tickertext","audiodescription","commentary","alternate","signlanguage"],r=s.slice(0,7),b=typeof b==="string"?b:"",d=typeof d==="string"?d:"",f=typeof f==="string"?f:"",p=typeof p==="boolean"?p:!1;if(!s.filter(function(a){return e===a?!0:!1}).length)throw c.createDOMException(12,
"DOMException 12: SYNTAX_ERR: You must use a valid kind when creating a TimedTextTrack.","SYNTAX_ERR");if(r.filter(function(a){return e===a?!0:!1}).length)if(b=new c.TextTrack(b,e,d,f,n)){if(!(a.tracks instanceof Array))a.tracks=[];a.tracks.push(b);return b}else return!1;else if(b=new c.MediaTrack(b,e,d,f,n,o,p)){if(!(a.mediaTracks instanceof Array))a.mediaTracks=[];a.mediaTracks.push(b);return b}else return!1}});if(!b||b===!1||b===void 0||b===null)d=[].slice.call(document.getElementsByTagName("video"),
0);else if(b instanceof Array)for(f=0;f<b.length;f++)typeof b[f]==="string"?d=d.concat([].slice.call(document.querySelectorAll(b[f]),0)):b[f].constructor===HTMLVideoElement&&d.push(b[f]);else typeof b==="string"?d=[].slice.call(document.querySelectorAll(b),0):b.constructor===HTMLVideoElement&&d.push(b);if(d.length){for(f=0;f<d.length;f++)c.processVideoElement(d[f],e,a);return!0}else return!1},processVideoElement:function(b,e,a){var d=[],f=navigator.language||navigator.userLanguage;e||f.split("-");
a=a instanceof Object?a:{};if(!b.captioned){b._captionatorOptions=a;b.className+=(b.className.length?" ":"")+"captioned";b.captioned=!0;if(b.id.length===0)b.id=c.generateID();[].slice.call(b.querySelectorAll("track"),0).forEach(function(f){var g=null,g=f.querySelectorAll("source").length>0?f.querySelectorAll("source"):f.getAttribute("src"),g=b.addTrack(f.getAttribute("id")||c.generateID(),f.getAttribute("kind"),f.getAttribute("label"),f.getAttribute("srclang").split("-")[0],g,f.getAttribute("type"),
f.hasAttribute("default"));f.track=g;g.trackNode=f;g.videoNode=b;d.push(g);var i=!1;if((g.kind==="subtitles"||g.kind==="captions")&&e===g.language&&a.enableCaptionsByDefault)d.filter(function(a){return(a.kind==="captions"||a.kind==="subtitles")&&e===a.language&&a.mode===c.TextTrack.SHOWING?!0:!1}).length||(i=!0);g.kind==="chapters"&&e===g.language&&(d.filter(function(a){return a.kind==="chapters"&&a.mode===c.TextTrack.SHOWING?!0:!1}).length||(i=!0));g.kind==="descriptions"&&a.enableDescriptionsByDefault===
!0&&e===g.language&&(d.filter(function(a){return a.kind==="descriptions"&&a.mode===c.TextTrack.SHOWING?!0:!1}).length||(i=!0));i===!0&&d.forEach(function(a){if(a.trackNode.hasAttribute("default")&&a.mode===c.TextTrack.SHOWING)a.mode=c.TextTrack.HIDDEN});if(f.hasAttribute("default")&&!d.filter(function(a){return a.trackNode.hasAttribute("default")&&a.trackNode!==f?!0:!1}).length)i=!0,g.internalDefault=!0;if(i===!0)g.mode=c.TextTrack.SHOWING});b.addEventListener("timeupdate",function(b){b=b.target;
try{b.tracks.forEach(function(a){a.activeCues.refreshCues()})}catch(e){}a.renderer instanceof Function?a.renderer.call(c,b):c.rebuildCaptions(b);c.synchroniseMediaElements(b)},!1);b.addEventListener("play",function(){c.synchroniseMediaElements(b)},!1);b.addEventListener("pause",function(){c.synchroniseMediaElements(b)},!1)}return b},rebuildCaptions:function(b){var e=b.currentTime,a=[],d=!1,f=[],l=[];(b.tracks||[]).forEach(function(b){b.mode===c.TextTrack.SHOWING&&b.readyState===c.TextTrack.LOADED&&
(l=[].slice.call(b.activeCues,0),l=l.sort(function(a,b){return a.startTime>b.startTime?-1:1}),a=a.concat(l))});f=a.map(function(a){return a.track.id+"."+a.id+":"+a.text.toString(e).length});if(d=!function(a,b){if(!(a instanceof Array)||!(b instanceof Array))return!1;if(a.length!==b.length)return!1;for(var c in a)if(a[c]!==b[c])return!1;return!0}(f,b._captionator_previousActiveCues))b._captionator_availableCueArea=null,b._captionator_previousActiveCues=f,c.styleCueCanvas(b),b._containerObject.innerHTML=
"",a.forEach(function(a){var d=document.createElement("div");d.id=String(a.id).length?a.id:c.generateID();d.className="captionator-cue";d.innerHTML=a.text.toString(e);b._containerObject.appendChild(d);c.styleCue(d,a,b)})},synchroniseMediaElements:function(b){var e=function(a,b){try{b.seeking&&a.pause();if(a.currentTime<b.currentTime-0.5||a.currentTime>b.currentTime+0.5)a.currentTime=b.currentTime;a.paused&&!b.paused?a.play():!a.paused&&b.paused&&a.pause()}catch(c){}};(b.mediaTracks||[]).forEach(function(a){a.mode===
c.TextTrack.SHOWING&&a.readyState>=c.TextTrack.LOADING&&e(a.mediaElement,b)});b.id&&[].slice.call(document.body.querySelectorAll("*[syncMaster="+b.id+"]"),0).forEach(function(a){(a.tagName.toLowerCase()==="video"||a.tagName.toLowerCase()==="audio")&&e(a,b)})},getNodeMetrics:function(b){for(var c=window.getComputedStyle(b,null),a=b,d=b.offsetTop,f=b.offsetLeft,l=b,g=0,i=0,l=parseInt(c.getPropertyValue("width"),10),g=parseInt(c.getPropertyValue("height"),10);a=a.offsetParent;)d+=a.offsetTop,f+=a.offsetLeft;
b.hasAttribute("controls")&&(b=navigator.userAgent.toLowerCase(),b.indexOf("chrome")!==-1?i=32:b.indexOf("opera")!==-1?i=25:b.indexOf("firefox")!==-1?i=28:b.indexOf("ie 9")!==-1||b.indexOf("ipad")!==-1?i=44:b.indexOf("safari")!==-1&&(i=25));return{left:f,top:d,width:l,height:g,controlHeight:i}},applyStyles:function(b,c){for(var a in c)({}).hasOwnProperty.call(c,a)&&(b.style[a]=c[a])},checkDirection:function(b){var c=RegExp("^[^\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]*[A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]");
return RegExp("^[^A-Za-z\u00c0-\u00d6\u00d8-\u00f6\u00f8-\u02b8\u0300-\u0590\u0800-\u1fff\u2c00-\ufb1c\ufdfe-\ufe6f\ufefd-\uffff]*[\u0591-\u07ff\ufb1d-\ufdfd\ufe70-\ufefc]").test(b)?"rtl":c.test(b)?"ltr":""},styleCue:function(b,e,a){var d=0,f=0,l=0,g=0,i,q,y=0,n=0,o,p,s,r,h,k,u=0,x=i=f=0,v=0,D=0,z=0,B,A,w=0,v=a._captionatorOptions||{},j,E=function(a){var b=function(a){return!!a.length},e,d,f,h,g=0;for(e in a.childNodes)if(a.childNodes.hasOwnProperty(e))d=a.childNodes[e],d.nodeType===3?(h=document.createDocumentFragment(),
f=d.nodeValue,h.appendChild(document.createElement("span")),h.childNodes[0].innerHTML="<span class='captionator-cue-character'>"+f.split(/(.)/).filter(b).join("</span><span class='captionator-cue-character'>")+"</span>",[].slice.call(h.querySelectorAll("span.captionator-cue-character"),0).forEach(function(a){g++;c.applyStyles(a,{display:"block",lineHeight:"auto",height:o+"px",width:k+"px",textAlign:"center"})}),d.parentNode.replaceChild(h,d)):a.childNodes[e].nodeType===1&&(g+=E(a.childNodes[e]));
return g};j=c.getNodeMetrics(a);if(!a._captionator_availableCueArea)a._captionator_availableCueArea={bottom:j.height-j.controlHeight,right:j.width,top:0,left:0,height:j.height-j.controlHeight,width:j.width};f=j.height*0.045/96*72;f=f>=10?f:10;o=Math.floor(f/72*96);p=Math.floor(f*1.5);p=p>16?p:16;k=h=Math.ceil(p/72*96);h*Math.floor(j.height/h)<j.height&&(h=Math.floor(j.height/Math.floor(j.height/h)),p=Math.ceil(h/96*72));h*Math.floor(j.width/h)<j.width&&(k=Math.ceil(j.width/Math.floor(j.width/h)));
s=Math.floor(a._captionator_availableCueArea.height/h);r=Math.floor(a._captionator_availableCueArea.width/k);i=parseFloat(String(e.size).replace(/[^\d\.]/ig,""),10);i=i<=100?i:100;y=e.direction==="horizontal"?Math.floor(j.width*0.01):0;n=e.direction==="horizontal"?0:Math.floor(j.height*0.01);if(e.linePosition==="auto")e.linePosition=e.direction==="horizontal"?s:r;else if(String(e.linePosition).match(/\%/))e.snapToLines=!1,e.linePosition=parseFloat(String(e.linePosition).replace(/\%/ig,""),10);e.direction===
"horizontal"?(g=h,l=a._captionator_availableCueArea.width*(i/100),e.textPosition==="auto"?d=(a._captionator_availableCueArea.right-l)/2+a._captionator_availableCueArea.left:(e.textPosition=parseFloat(String(e.textPosition).replace(/[^\d\.]/ig,""),10),d=(a._captionator_availableCueArea.right-l)*(e.textPosition/100)+a._captionator_availableCueArea.left),f=e.snapToLines===!0?(s-1)*h+a._captionator_availableCueArea.top:(j.height-(j.controlHeight+h+n*2))*(e.linePosition/100)):(f=a._captionator_availableCueArea.top,
d=a._captionator_availableCueArea.right-k,l=k,g=a._captionator_availableCueArea.height*(i/100),f=E(b),i=[].slice.call(b.querySelectorAll("span.captionator-cue-character"),0),u=Math.floor((g-n*2)/o),l=Math.ceil(f/u)*k,x=Math.ceil(f/u),D=(f-u*(x-1))*o,e.snapToLines===!0?d=e.direction==="vertical-lr"?a._captionator_availableCueArea.left:a._captionator_availableCueArea.right-l:(f=l+y*2,d=e.direction==="vertical-lr"?(j.width-f)*(e.linePosition/100):j.width-(j.width-f)*(e.linePosition/100)),e.textPosition===
"auto"?f=(a._captionator_availableCueArea.bottom-g)/2+a._captionator_availableCueArea.top:(e.textPosition=parseFloat(String(e.textPosition).replace(/[^\d\.]/ig,""),10),f=(a._captionator_availableCueArea.bottom-g)*(e.textPosition/100)+a._captionator_availableCueArea.top),A=B=w=z=0,i.forEach(function(a){B=e.direction==="vertical-lr"?k*z:l-k*(z+1);e.alignment==="start"||e.alignment==="middle"&&z<x-1?A=w*o+n:e.alignment==="end"?A=g-n-w*o:e.alignment==="middle"&&(A=(g-n*2-D)/2+w*o);c.applyStyles(a,{position:"absolute",
top:A+"px",left:B+"px"});w>=u-1?(w=0,z++):w++}));e.direction==="horizontal"&&(q=c.checkDirection(String(e.text))==="rtl"?{start:"right",middle:"center",end:"left"}[e.alignment]:{start:"left",middle:"center",end:"right"}[e.alignment]);c.applyStyles(b,{position:"absolute",overflow:"hidden",width:l+"px",height:g+"px",top:f+"px",left:d+"px",padding:n+"px "+y+"px",textAlign:q,backgroundColor:"rgba("+F.join(",")+")",direction:c.checkDirection(String(e.text)),lineHeight:p+"pt",boxSizing:"border-box"});if(e.direction===
"vertical"||e.direction==="vertical-lr")d-a._captionator_availableCueArea.left-a._captionator_availableCueArea.left>=a._captionator_availableCueArea.right-(d+l)?a._captionator_availableCueArea.right=d:a._captionator_availableCueArea.left=d+l,a._captionator_availableCueArea.width=a._captionator_availableCueArea.right-a._captionator_availableCueArea.left,console.log(a._captionator_availableCueArea);else{if(b.scrollHeight>b.offsetHeight*1.2){if(e.snapToLines){for(q=0;b.scrollHeight>b.offsetHeight*1.2;)g+=
h,b.style.height=g+"px",q++;f-=q*h}else q=b.scrollHeight-g,g=b.scrollHeight+j.height*0.01,f-=q,b.style.height=g+"px";b.style.top=f+"px"}f-a._captionator_availableCueArea.top-a._captionator_availableCueArea.top>=a._captionator_availableCueArea.bottom-(f+g)?a._captionator_availableCueArea.bottom=f:a._captionator_availableCueArea.top=f+g;a._captionator_availableCueArea.height=a._captionator_availableCueArea.bottom-a._captionator_availableCueArea.top}if(v.debugMode){var t,m,C=function(){if(!t)a._captionatorDebugCanvas?
(t=a._captionatorDebugCanvas,m=a._captionatorDebugContext):(t=document.createElement("canvas"),t.setAttribute("width",j.width),t.setAttribute("height",j.height-j.controlHeight),document.body.appendChild(t),c.applyStyles(t,{position:"absolute",top:j.top+"px",left:j.left+"px",width:j.width+"px",height:j.height-j.controlHeight+"px",zIndex:3E3}),m=t.getContext("2d"),a._captionatorDebugCanvas=t,a._captionatorDebugContext=m)};C();t.setAttribute("width",j.width);C();m.fillStyle="rgba(100,100,255,0.5)";m.fillRect(a._captionator_availableCueArea.left,
a._captionator_availableCueArea.top,a._captionator_availableCueArea.right,a._captionator_availableCueArea.bottom);m.stroke();(function(){var b;C();m.strokeStyle="rgba(255,0,0,0.5)";m.lineWidth=1;m.beginPath();for(b=0;b<s;b++)m.moveTo(0.5,b*h+0.5),m.lineTo(j.width,b*h+0.5);m.closePath();m.stroke();m.beginPath();m.strokeStyle="rgba(0,255,0,0.5)";for(b=r;b>=0;b--)m.moveTo(j.width-b*k-0.5,-0.5),m.lineTo(j.width-b*k-0.5,j.height);m.closePath();m.stroke();m.beginPath();m.strokeStyle="rgba(255,255,0,0.5)";
for(b=0;b<=r;b++)m.moveTo(b*k+0.5,-0.5),m.lineTo(b*k+0.5,j.height);m.stroke();a.linesDrawn=!0})()}},styleCueCanvas:function(b){var e,a;if(!(b instanceof HTMLVideoElement))throw Error("Cannot style a cue canvas for a non-video node!");if(b._containerObject)a=b._containerObject,e=a.id;a?a.parentNode||document.body.appendChild(a):(a=document.createElement("div"),a.className="captionator-cue-canvas",e=c.generateID(),a.id=e,document.body.appendChild(a),b._containerObject=a,a.setAttribute("aria-live","polite"),
a.setAttribute("aria-atomic","true"));if(String(b.getAttribute("aria-describedby")).indexOf(e)===-1){var d=b.hasAttribute("aria-describedby")?b.getAttribute("aria-describedby")+" ":"";b.setAttribute("aria-describedby",d+e)}d=c.getNodeMetrics(b);b=d.height*0.045/96*72;b=b>=10?b:10;e=Math.floor(b*1.5);c.applyStyles(a,{position:"absolute",overflow:"hidden",zIndex:100,height:d.height-d.controlHeight+"px",width:d.width+"px",top:d.top+"px",left:d.left+"px",color:"white",fontFamily:"Verdana, Helvetica, Arial, sans-serif",
fontSize:b+"pt",lineHeight:(e>16?e:16)+"pt",boxSizing:"border-box"});if(window.navigator.userAgent.toLowerCase().indexOf("chrome/10")>-1)a.style.backgroundColor="rgba(0,0,0,0.01"+Math.random().toString().replace(".","")+")"},parseCaptions:function(b,e){var e=e instanceof Object?e:{},a="",d=[],f=/^(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\,(\d{2})?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,l=/^(\d+)?:?(\d{2}):(\d{2})\.(\d+)\,(\d+)?:?(\d{2}):(\d{2})\.(\d+)\s*(.*)/,g=/^(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s+\-\-\>\s+(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)\s*(.*)/,
i=/(\d{2})?:?(\d{2}):(\d{2})[\.\,](\d+)/,q=/^([\d\.]+)\s+\+([\d\.]+)\s*(.*)/,y=/^\[(\d{2})?:?(\d{2})\:(\d{2})\.(\d{2})\]\s*(.*?)$/i;if(b){var n=function(a){var b=new c.CaptionatorCueStructure(a,e),d=[],f,h,g,l=[];g=0;var n=function(a){return!!a.replace(/[^a-z0-9]+/ig,"").length},d=a.split(/(<\/?[^>]+>)/ig).filter(function(a){return!!a.replace(/\s*/ig,"")});g=b;for(f in d)if(d.hasOwnProperty(f))if(h=d[f],h.substr(0,1)==="<")if(h.substr(1,1)==="/"){if(a=h.substr(2).split(/[\s>]+/g)[0],l.length>0){h=
0;for(g=l.length-1;g>=0;g--){var q=l[g][l[g].length-1];h=g;if(q.token===a)break}g=l[h];l=l.slice(0,h)}}else{if(h.substr(1).match(i)||h.match(/^<v\s+[^>]+>/i)||h.match(/^<c[a-z0-9\-\_\.]+>/)||h.match(/^<(b|i|u|ruby|rt)>/)||e.sanitiseCueHTML!==!1){a={token:h.replace(/[<\/>]+/ig,"").split(/[\s\.]+/)[0],rawToken:h,children:[]};if(a.token==="v")a.voice=h.match(/^<v\s*([^>]+)>/i)[1];else if(a.token==="c")a.classes=h.replace(/[<\/>\s]+/ig,"").split(/[\.]+/ig).slice(1).filter(n);else if(h=a.rawToken.match(i))b.isTimeDependent=
!0,h=h.slice(1),a.timeIn=parseInt((h[0]||0)*3600,10)+parseInt((h[1]||0)*60,10)+parseInt(h[2]||0,10)+parseFloat("0."+(h[3]||0),10);g.push(a);l.push(g);g=a.children}}else e.sanitiseCueHTML!==!1&&(h=h.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\&/g,"&amp;")),g.push(h);return b},d=b.replace(/\r\n/g,"\n").replace(/\r/g,"\n");y.exec(b)?(d=d.split(/\n+/g),a="LRC"):d=d.split(/\n\n+/g);return d=d.filter(function(b){if(b.match(/^WEBVTT(\s*FILE)?/ig))a="WebVTT";else if(b.replace(/\s*/ig,"").length)return!0;
return!1}).map(function(b,d){var i,r,h,k,u,x;for(i=a==="LRC"?[b.substr(0,b.indexOf("]")),b.substr(b.indexOf("]")+1)]:b.split(/\n/g);!i[0].replace(/\s+/ig,"").length&&i.length>0;)i.shift();for(x=i[0].match(/^\s*\d+\s*$/ig)?String(i.shift().replace(/\s*/ig,"")):d;0<i.length;){var v=i[0];if((k=g.exec(v))||(k=f.exec(v))||(k=l.exec(v)))k=k.slice(1),r=parseInt((k[0]||0)*3600,10)+parseInt((k[1]||0)*60,10)+parseInt(k[2]||0,10)+parseFloat("0."+(k[3]||0),10),h=parseInt((k[4]||0)*3600,10)+parseInt((k[5]||0)*
60,10)+parseInt(k[6]||0,10)+parseFloat("0."+(k[7]||0),10),k[8]&&(u=k[8]);else if(k=q.exec(v))k=k.slice(1),r=parseFloat(k[0],10),h=r+parseFloat(k[1],10),k[2]&&(u=k[2]);i=i.slice(0,0).concat(i.slice(1));break}i=e.processCueHTML===!1?i.join("\n"):n(i.join("\n"));return new c.TextTrackCue(x,r,h,i,u,!1,null)})}else throw Error("Required parameter captionData not supplied.");}};window.captionator=c})();